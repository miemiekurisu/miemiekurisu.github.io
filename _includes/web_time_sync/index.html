<div class="web-time-sync" lang="zh-CN">
  <style>
    .web-time-sync {
      color-scheme: dark;
      --bg0: #070a14;
      --bg1: #0b1020;
      --card: rgba(18, 26, 51, 0.78);
      --text: #eaf0ff;
      --muted: rgba(233, 240, 255, 0.68);
      --border: rgba(255, 255, 255, 0.12);
      --shadow: rgba(0, 0, 0, 0.45);
      --accent: #7aa2ff;
      --accent2: #38d9a9;
      --danger: #ff6b6b;
      --ok: #38d9a9;
      --radius: 14px;
      --radius-sm: 12px;
      --pad: 16px;
      --pad-sm: 12px;
      --focus: 0 0 0 3px rgba(122, 162, 255, 0.25);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
      background:
        radial-gradient(1200px 700px at 18% 10%, rgba(122,162,255,0.30), transparent 62%),
        radial-gradient(900px 540px at 82% 16%, rgba(56,217,169,0.22), transparent 56%),
        radial-gradient(900px 560px at 55% 110%, rgba(255,107,107,0.10), transparent 52%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--text);
      border-radius: 12px;
      overflow: hidden;
    }

    .web-time-sync * { box-sizing: border-box; }

    .web-time-sync .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 22px;
    }

    .web-time-sync .header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 14px;
      align-items: start;
      margin-bottom: 14px;
    }

    .web-time-sync h1 {
      font-size: 18px;
      margin: 0;
      letter-spacing: 0.2px;
      font-weight: 800;
    }

    .web-time-sync .hint {
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
      max-width: 640px;
    }

    .web-time-sync .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .web-time-sync .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: 0 14px 42px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .web-time-sync .row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .web-time-sync button {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 750;
      letter-spacing: 0.15px;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease, opacity 120ms ease;
      user-select: none;
    }
    .web-time-sync button:hover { border-color: rgba(122,162,255,0.55); transform: translateY(-1px); }
    .web-time-sync button:active { transform: translateY(0px); }
    .web-time-sync button:focus-visible { outline: none; box-shadow: var(--focus); }
    .web-time-sync button:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }

    .web-time-sync .primary {
      border-color: rgba(122,162,255,0.65);
      background: linear-gradient(180deg, rgba(122,162,255,0.22), rgba(122,162,255,0.10));
    }
    .web-time-sync .danger {
      border-color: rgba(255,107,107,0.55);
      background: linear-gradient(180deg, rgba(255,107,107,0.18), rgba(255,107,107,0.08));
    }

    .web-time-sync .pill {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      white-space: nowrap;
    }
    .web-time-sync .pill.ok { color: var(--ok); border-color: rgba(56,217,169,0.45); }
    .web-time-sync .pill.bad { color: var(--danger); border-color: rgba(255,107,107,0.45); }

    .web-time-sync label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 12px;
      margin-left: 2px;
    }

    .web-time-sync input[type="number"] {
      width: 100px;
      padding: 9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      outline: none;
      transition: border-color 120ms ease, box-shadow 120ms ease;
    }
    .web-time-sync input[type="number"]:focus { border-color: rgba(122,162,255,0.6); box-shadow: var(--focus); }

    .web-time-sync .kv {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px 12px;
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
    }
    .web-time-sync .kv b {
      color: rgba(233, 240, 255, 0.92);
      font-weight: 700;
      overflow-wrap: anywhere;
    }

    .web-time-sync .log {
      margin-top: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      color: rgba(207, 224, 255, 0.95);
      height: min(360px, 46vh);
      overflow: auto;
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.30);
      white-space: pre-wrap;
    }

    @media (max-width: 720px) {
      .web-time-sync .wrap { padding: 16px; }
      .web-time-sync .header { grid-template-columns: 1fr; }
      .web-time-sync .card { padding: var(--pad-sm); }
      .web-time-sync .kv { grid-template-columns: 1fr; gap: 6px 10px; }
      .web-time-sync .kv span { opacity: 0.9; }
      .web-time-sync .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        align-items: stretch;
      }
      .web-time-sync .row button { width: 100%; }
      .web-time-sync label {
        grid-column: 1 / -1;
        justify-content: space-between;
      }
      .web-time-sync #timeSourcePill { grid-column: 1 / -1; justify-self: start; }
      .web-time-sync #btnSync { grid-column: 1 / -1; }
    }

    @media (max-width: 420px) {
      .web-time-sync .row { grid-template-columns: 1fr; }
      .web-time-sync #btnSync { grid-column: auto; }
      .web-time-sync input[type="number"] { width: 100%; }
    }
  </style>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>BLE 标签时间同步（Web Bluetooth）</h1>
        <div class="hint">
          需要在 HTTPS 或 localhost 下运行（浏览器要求）。
          页面会在后台自动获取“准确时间”：优先使用网络时间 API（UTC），失败则回退为本机时间。
        </div>
      </div>
      <div class="row">
        <span id="statusPill" class="pill">未连接</span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <button id="btnConnect" class="primary">连接 BLE</button>
          <button id="btnDisconnect" class="danger" disabled>断开</button>
          <button id="btnSync" class="primary" disabled>同步时间</button>
          <label>
            时区偏移(小时)
            <input id="tzOffset" type="number" min="-12" max="14" step="0.5" />
          </label>
          <span class="pill" id="timeSourcePill">时间源：未知</span>
        </div>

        <div class="kv">
          <span>设备</span><b id="deviceName">-</b>
          <span>最近一次获取时间</span><b id="lastFetch">-</b>
          <span>最近一次同步</span><b id="lastSync">-</b>
        </div>

        <div class="log" id="log"></div>
      </div>
    </div>
  </div>

  <script type="module" src="{{ '/web_time_sync/js/app.js' | relative_url }}"></script>
</div>
